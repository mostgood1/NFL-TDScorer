<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <form class="row g-2" method="get" action="/ui/teams">
      <input type="hidden" name="tab" value="teams" />
      <div class="col-auto">
        <label class="form-label">Season</label>
        <input class="form-control" name="season" value="{{ season }}" />
      </div>
      <div class="col-auto">
        <label class="form-label">Week</label>
        <input class="form-control" name="week" value="{{ week }}" />
      </div>
      <div class="col-auto align-self-end">
        <button class="btn btn-primary">Load</button>
      </div>
      <div class="col-auto align-self-end">
        <a class="btn btn-outline-secondary" href="/ui?tab=players&season={{ season }}&week={{ week }}">View Players</a>
      </div>
    </form>
  </div>
</div>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
  {% for c in cards %}
  <div class="col">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="card-title d-flex align-items-center gap-2">
          {% if c.logo_url %}
          <img class="headshot" src="{{ c.logo_url }}" alt="{{ c.team }} logo" />
          {% else %}
          <div class="team-avatar {{ c.team_class }}">{{ c.team_abbr }}</div>
          {% endif %}
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between">
              <strong>{{ c.team }}</strong>
              <span class="badge text-bg-primary">Team TDs {{ c.team_tds|fmt2 }}</span>
            </div>
            <div class="muted">vs {{ c.opp }}</div>
          </div>
        </div>
        <div class="small mt-2">
          <div class="d-flex justify-content-between">
            <div>RB: <strong>{{ c.by_pos['RB']|fmt2 }}</strong></div>
            <div>WR: <strong>{{ c.by_pos['WR']|fmt2 }}</strong></div>
            <div>TE: <strong>{{ c.by_pos['TE']|fmt2 }}</strong></div>
            <div>QB: <strong>{{ c.by_pos['QB']|fmt2 }}</strong></div>
          </div>
        </div>
        {% if c.hist_pos_counts or c.hist_pos %}
        <div class="small mt-2">
          <div class="fw-semibold">2024 Breakdown</div>
          <div class="d-flex justify-content-between">
            <div>
              <span class="text-muted"># RB/WR/TE/QB</span>:
              <strong>
                {{ c.hist_pos_counts['RB'] if c.hist_pos_counts else 0 }} /
                {{ c.hist_pos_counts['WR'] if c.hist_pos_counts else 0 }} /
                {{ c.hist_pos_counts['TE'] if c.hist_pos_counts else 0 }} /
                {{ c.hist_pos_counts['QB'] if c.hist_pos_counts else 0 }}
              </strong>
            </div>
            <div>
              <span class="text-muted">% RB/WR/TE/QB</span>:
              <strong>
                {{ ((c.hist_pos['RB']*100)|fmt2) if c.hist_pos else '0' }}% /
                {{ ((c.hist_pos['WR']*100)|fmt2) if c.hist_pos else '0' }}% /
                {{ ((c.hist_pos['TE']*100)|fmt2) if c.hist_pos else '0' }}% /
                {{ ((c.hist_pos['QB']*100)|fmt2) if c.hist_pos else '0' }}%
              </strong>
            </div>
          </div>
        </div>
        {% endif %}
        <div class="mt-3 d-flex justify-content-end">
          <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#tmodal_{{ loop.index }}">Details</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="tmodal_{{ loop.index }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ c.team }} — Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <h6>Context</h6>
              <ul class="small">
                <li>Matchup: {{ c.team }} vs {{ c.opp }} {{ '(home)' if c.is_home else '(away)' }}</li>
                <li>Projected team TDs: {{ c.team_tds|fmt2 }}</li>
                {% if c.proj_kind %}
                <li>Projected split (Week {{ week }}): Pass {{ (c.proj_kind.pass*100)|fmt2 }}% • Rush {{ (c.proj_kind.rush*100)|fmt2 }}%</li>
                {% endif %}
              </ul>
            </div>
            <div class="col-md-6">
              <h6>TDs by position</h6>
              <ul class="small">
                <li>RB: {{ c.by_pos['RB']|fmt2 }}</li>
                <li>WR: {{ c.by_pos['WR']|fmt2 }}</li>
                <li>TE: {{ c.by_pos['TE']|fmt2 }}</li>
                <li>QB: {{ c.by_pos['QB']|fmt2 }}</li>
              </ul>
              {% if c.hist_kind %}
              <h6 class="mt-3">2024 Breakdown (shares)</h6>
              <ul class="small">
                <li>Pass/Rush: {{ (c.hist_kind.pass*100)|fmt2 }}% / {{ (c.hist_kind.rush*100)|fmt2 }}%</li>
                {% if c.hist_pos %}
                <li>By Position — RB {{ (c.hist_pos.RB*100)|fmt2 }}% • WR {{ (c.hist_pos.WR*100)|fmt2 }}% • TE {{ (c.hist_pos.TE*100)|fmt2 }}% • QB {{ (c.hist_pos.QB*100)|fmt2 }}%</li>
                {% endif %}
              </ul>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
